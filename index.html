<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Anónimo [Nombre Colaborativo]</title>
    <style>
        /* Estilos CSS (Idénticos a los anteriores para mantener tu diseño favorito) */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a2e;
            color: #e0e0e0;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(167, 92, 232, 0.1) 0%, rgba(26, 26, 46, 0.8) 70%);
            animation: backgroundPulse 15s infinite alternate;
            z-index: -1;
        }

        @keyframes backgroundPulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.1); opacity: 1; }
        }

        .container {
            background-color: rgba(30, 30, 40, 0.95);
            border-radius: 15px;
            box-shadow: 0 0 40px rgba(167, 92, 232, 0.7);
            padding: 30px;
            width: 90%;
            max-width: 650px;
            animation: fadeIn 1.5s ease-out;
            border: 1px solid rgba(167, 92, 232, 0.4);
            position: relative;
            z-index: 1;
            /* CAMBIO IMPORTANTE: Por defecto el contenedor del chat estará oculto */
            display: none; 
            flex-direction: column; /* Para organizar el contenido verticalmente */
        }

        /* NUEVO: Estilos para la sección inicial de bienvenida/reglas */
        #welcome-screen {
            background-color: rgba(30, 30, 40, 0.95);
            border-radius: 15px;
            box-shadow: 0 0 40px rgba(167, 92, 232, 0.7);
            padding: 30px;
            width: 90%;
            max-width: 650px;
            animation: fadeIn 1.5s ease-out;
            border: 1px solid rgba(167, 92, 232, 0.4);
            position: relative;
            z-index: 1;
            display: flex; /* CAMBIO IMPORTANTE: Visible por defecto */
            flex-direction: column;
            align-items: center;
            text-align: center;
            height: fit-content; /* Ajusta la altura al contenido */
            max-height: 90vh; /* Limita la altura para no desbordar */
            overflow-y: auto; /* Permite scroll si el contenido es mucho */
        }

        #welcome-screen h1 {
            font-size: 2.5em;
            color: #fff;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #a75ce8;
        }
        #welcome-screen p {
            font-size: 1.1em;
            color: #d1baff;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        #welcome-screen ul {
            list-style: none;
            padding: 0;
            margin: 0 0 30px 0;
            text-align: left;
            width: 90%;
            max-width: 450px;
        }
        #welcome-screen ul li {
            background-color: rgba(60, 60, 80, 0.5);
            margin-bottom: 10px;
            padding: 12px 18px;
            border-radius: 8px;
            border-left: 4px solid #a75ce8;
            font-size: 1em;
            color: #e0e0e0;
            display: flex;
            align-items: center;
        }
        #welcome-screen ul li::before {
            content: '✓'; /* Icono de check */
            color: #4CAF50; /* Color verde */
            font-weight: bold;
            margin-right: 10px;
        }

        #start-chat-button {
            background-color: #4CAF50; /* Verde para el botón de inicio */
            color: #fff;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.3em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            margin-top: 20px; /* Separación del contenido */
        }
        #start-chat-button:hover {
            background-color: #45a049;
            transform: translateY(-3px);
        }
        #start-chat-button:active {
            transform: translateY(0);
        }


        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(-30px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .welcome-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(167, 92, 232, 0.3);
        }

        .profile-container {
            display: flex;
            flex-direction: column; 
            align-items: center;
            margin-bottom: 15px;
        }
        
        /* Contenedor para las dos tarjetas de perfil */
        .profile-cards-wrapper {
            display: flex; 
            justify-content: center;
            gap: 25px; /* Más espacio entre las tarjetas */
            margin-bottom: 15px;
            flex-wrap: wrap; /* Para que se ajusten en pantallas pequeñas */
        }

        .profile-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none; /* Eliminar subrayado de enlace */
            color: inherit; /* Heredar color del padre */
            transition: transform 0.3s ease;
        }

        .profile-card:hover {
            transform: translateY(-5px); /* Pequeño efecto al pasar el mouse */
        }

        .profile-image {
            width: 100px; /* Tamaño de la imagen de perfil */
            height: 100px;
            border-radius: 50%;
            border: 4px solid #a75ce8;
            box-shadow: 0 0 15px rgba(167, 92, 232, 1);
            margin-bottom: 8px; /* Espacio entre la imagen y el nombre */
            object-fit: cover; /* Asegura que la imagen cubra el área sin distorsionarse */
            flex-shrink: 0; /* Evita que la imagen se encoja */
        }
        
        .profile-name {
            font-size: 1.1em; /* Tamaño del nombre del canal */
            font-weight: bold;
            color: #d1baff; /* Color del texto del nombre */
            text-align: center;
            max-width: 120px; /* Limita el ancho del nombre para que no se extienda demasiado */
            word-wrap: break-word; /* Rompe palabras largas si es necesario */
        }

        .welcome-header h1 {
            font-size: 2.5em;
            color: #fff;
            margin-top: 5px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #a75ce8;
            animation: textGlow 2s infinite alternate;
        }

        @keyframes textGlow {
            0% { text-shadow: 0 0 5px #a75ce8; }
            100% { text-shadow: 0 0 20px #a75ce8, 0 0 30px #a75ce8; }
        }

        .welcome-message {
            font-size: 1.3em;
            color: #d1baff;
            font-style: italic;
        }

        .anonymous-name-section {
            text-align: center;
            margin-bottom: 25px;
            color: #e0e0e0;
            background-color: rgba(60, 60, 80, 0.5);
            padding: 15px;
            border-radius: 8px;
            border: 1px dashed #a75ce8;
            animation: revealName 1.5s ease-out forwards;
            opacity: 0;
            /* CAMBIO IMPORTANTE: Solo se mostrará cuando se active el chat */
            display: none; 
        }

        @keyframes revealName {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .anonymous-name-section p {
            font-size: 1.1em;
            font-weight: bold;
            color: #d1baff;
        }

        .question-section {
            background-color: rgba(40, 40, 55, 0.7);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 6px solid #a75ce8;
            box-shadow: 0 0 15px rgba(167, 92, 232, 0.3);
            /* CAMBIO IMPORTANTE: Solo se mostrará cuando se active el chat */
            display: none; 
        }

        .question-section h2 {
            color: #a75ce8;
            margin-top: 0;
            font-size: 1.6em;
            margin-bottom: 10px;
        }

        .question-section p {
            font-size: 1.15em;
            line-height: 1.6;
            color: #e0e0e0;
        }

        .chat-section {
            background-color: rgba(35, 35, 50, 0.8);
            padding: 20px;
            border-radius: 10px;
            height: 350px;
            overflow-y: auto;
            border: 1px solid rgba(167, 92, 232, 0.2);
            /* Añadido margen inferior para separar del botón de envío */
            margin-bottom: 20px; 
            /* CAMBIO IMPORTANTE: Solo se mostrará cuando se active el chat */
            display: none; 
        }

        .chat-section::-webkit-scrollbar {
            width: 8px;
        }
        .chat-section::-webkit-scrollbar-track {
            background: #2a2a3a;
            border-radius: 10px;
        }
        .chat-section::-webkit-scrollbar-thumb {
            background: #6a3d9a;
            border-radius: 10px;
        }
        .chat-section::-webkit-scrollbar-thumb:hover {
            background: #a75ce8;
        }

        #chat-messages {
            display: flex;
            flex-direction: column;
            padding-bottom: 15px;
        }

        .message {
            background-color: #4a3366;
            color: #fff;
            padding: 12px 18px;
            border-radius: 20px;
            margin-bottom: 10px;
            word-break: break-word;
            max-width: 85%;
            align-self: flex-start;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            animation: messageFadeIn 0.5s ease-out;
            position: relative; /* Para el botón de eliminar */
        }

        @keyframes messageFadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Estilos del botón de eliminar (solo para admin) */
        .delete-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 0.8em;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: -8px; /* Ajusta la posición */
            right: -8px; /* Ajusta la posición */
            display: none; /* Oculto por defecto */
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }
        .delete-btn:hover {
            background-color: #c0392b;
        }
        /* Mostrar el botón de eliminar cuando es admin */
        body.admin-mode .delete-btn {
            display: flex;
        }

        .input-area {
            display: flex;
            margin-top: 0; /* Eliminado el margen superior para que el margen inferior del chat-section lo controle */
            gap: 10px;
        }

        #message-input {
            flex-grow: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background-color: #3a3a4a;
            color: #e0e0e0;
            font-size: 1em;
            outline: none;
            border: 1px solid #6a3d9a;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        #message-input::placeholder {
            color: #b0b0b0;
        }

        #message-input:focus {
            border-color: #a75ce8;
            box-shadow: 0 0 10px rgba(167, 92, 232, 0.6);
        }

        #send-button {
            background-color: #a75ce8;
            color: #fff;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.05em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }

        #send-button:hover {
            background-color: #8c45c9;
            transform: translateY(-2px);
        }

        #send-button:active {
            transform: translateY(0);
        }

        /* --- Estilos del Panel de Administración (solo para ti) --- */
        .admin-controls {
            background-color: rgba(50, 50, 70, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
            border: 1px dashed #7a46ad;
            display: none; /* Oculto por defecto para no-admin */
            flex-direction: column;
            gap: 15px;
        }

        .admin-controls h3 {
            color: #a75ce8;
            margin-top: 0;
            border-bottom: 1px solid rgba(167, 92, 232, 0.3);
            padding-bottom: 10px;
        }

        .admin-controls label {
            font-weight: bold;
            color: #d1baff;
        }

        .admin-controls input[type="text"] {
            width: calc(100% - 22px);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #6a3d9a;
            background-color: #3a3a4a;
            color: #e0e0e0;
            margin-top: 5px;
        }

        .admin-controls button {
            background-color: #a75ce8;
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }
        .admin-controls button:hover {
            background-color: #8c45c9;
        }

        /* Mostrar panel de admin cuando el modo admin está activo */
        body.admin-mode .admin-controls {
            display: flex;
        }

        /* Botón de login/logout */
        #auth-button {
            background-color: #555;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 10;
            transition: background-color 0.2s;
        }
        #auth-button:hover {
            background-color: #777;
        }
    </style>
</head>
<body>
    <button id="auth-button">Iniciar Sesión (Admin)</button>

    <div id="welcome-screen">
        <header class="welcome-header">
            <div class="profile-container">
                <div class="profile-cards-wrapper">
                    <a href="URL_CANAL_YOUTUBE_TUYO" target="_blank" class="profile-card">
                        <img src="https://via.placeholder.com/100/FF00FF/FFFFFF?text=Tu+Perfil" alt="Tu Perfil" class="profile-image"> 
                        <span class="profile-name">NOMBRE_TU_CANAL</span>
                    </a>
                    <a href="URL_CANAL_YOUTUBE_COLABORADOR" target="_blank" class="profile-card">
                        <img src="https://via.placeholder.com/100/800080/FFFFFF?text=Colaborador" alt="Perfil Colaborador" class="profile-image">
                        <span class="profile-name">NOMBRE_CANAL_COLABORADOR</span>
                    </a>
                </div>
                <h1 id="collaborative-title-welcome">Nombre Colaborativo</h1> 
            </div>
            <p class="welcome-message">¡Bienvenido/a a la dinámica anónima!</p>
            <p>Lee las siguientes reglas para participar:</p>
        </header>
        
        <ul>
            <li>Sé respetuoso/a con todos los participantes.</li>
            <li>No compartas información personal identificable.</li>
            <li>Mantén un lenguaje apropiado y positivo.</li>
            <li>Diviértete y sé parte de la conversación.</li>
        </ul>

        <button id="start-chat-button">Continuar al Chat</button>
    </div>

    <div class="container" id="chat-main-content">
        <header class="welcome-header">
            <div class="profile-container">
                <div class="profile-cards-wrapper">
                    <a href="URL_CANAL_YOUTUBE_TUYO" target="_blank" class="profile-card">
                        <img src="https://via.placeholder.com/100/FF00FF/FFFFFF?text=Tu+Perfil" alt="Tu Perfil" class="profile-image"> 
                        <span class="profile-name">NOMBRE_TU_CANAL</span>
                    </a>
                    <a href="URL_CANAL_YOUTUBE_COLABORADOR" target="_blank" class="profile-card">
                        <img src="https://via.placeholder.com/100/800080/FFFFFF?text=Colaborador" alt="Perfil Colaborador" class="profile-image">
                        <span class="profile-name">NOMBRE_CANAL_COLABORADOR</span>
                    </a>
                </div>
                <h1 id="collaborative-title">Nombre Colaborativo</h1> 
            </div>
            <p class="welcome-message">¡Participa en el chat anónimo!</p>
        </header>

        <div class="anonymous-name-section">
            <p id="anonymous-name">Generando tu nombre anónimo...</p>
        </div>

        <div class="question-section">
            <h2 id="question-title-prefix">Pregunta de [Nombre Colaborativo]:</h2> 
            <p id="current-question">Esperando la pregunta de [Nombre Colaborativo]...</p>
        </div>

        <div class="chat-section">
            <div id="chat-messages">
                <div class="message">¡Hola! Este es un espacio anónimo. ¡Sé respetuoso/a y diviértete!</div>
            </div>
            <div class="input-area">
                <input type="text" id="message-input" placeholder="Escribe tu respuesta anónima aquí...">
                <button id="send-button">Enviar</button>
            </div>
        </div>

        <div class="admin-controls">
            <h3>Control de Administrador</h3>
            <div>
                <label for="admin-question-input">Editar Pregunta:</label>
                <input type="text" id="admin-question-input" placeholder="Escribe aquí la nueva pregunta...">
                <button id="update-question-btn">Actualizar Pregunta</button>
            </div>
            <p>Los botones "X" para eliminar comentarios aparecerán junto a cada mensaje cuando inicies sesión como administrador.</p>
        </div>

    </div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>
        // ¡IMPORTANTE! Conecta a tu backend local. Asegúrate de que el puerto (3000) sea el mismo que el de tu backend.
        const socket = io('https://michat-backend.onrender.com'); // ¡IMPORTANTE! Reemplazar con la URL que te dé Render.com; 

        // --- Variables globales y elementos del DOM ---
        let currentAnonymousName = '';
        const anonymousNames = [
            "Sombra Misteriosa", "Enigma Lila", "Voz Oculta", "Secreto Estelar",
            "Eco Anónimo", "Mente Velada", "Susurro del Alma", "Observador Silente",
            "Viajero Enigmático", "Navegante Invisible", "Alma Púrpura", "Luz Encapuchada",
            "Gema Anónima", "Espectro Amistoso", "Susurro Violeta", "Código Desconocido"
        ];

        const welcomeScreen = document.getElementById('welcome-screen'); // NUEVO
        const startChatButton = document.getElementById('start-chat-button'); // NUEVO
        const chatMainContent = document.getElementById('chat-main-content'); // NUEVO
        
        const anonymousNameElement = document.getElementById('anonymous-name');
        const questionElement = document.getElementById('current-question');
        const chatMessagesElement = document.getElementById('chat-messages');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const authButton = document.getElementById('auth-button'); // Botón de "Iniciar Sesión (Admin)"
        const adminControls = document.querySelector('.admin-controls'); // Panel de controles de admin
        const adminQuestionInput = document.getElementById('admin-question-input'); // Input para la pregunta
        const updateQuestionBtn = document.getElementById('update-question-btn'); // Botón para actualizar pregunta
        
        // Obtener el nombre del equipo colaborativo del H1 y actualizar los prefijos de la pregunta
        const collaborativeTitleElement = document.getElementById('collaborative-title');
        const questionTitlePrefixElement = document.getElementById('question-title-prefix');
        // NUEVO: Obtener el título colaborativo de la pantalla de bienvenida también
        const collaborativeTitleWelcomeElement = document.getElementById('collaborative-title-welcome');


        // Función para actualizar los títulos de las preguntas
        const updateQuestionTitles = () => {
            // Usa el texto del título colaborativo en la pantalla de bienvenida para inicializar
            const currentCollaborativeName = collaborativeTitleWelcomeElement.textContent; // CAMBIO
            // Asegúrate de que ambos títulos estén sincronizados, aunque uno esté oculto
            collaborativeTitleElement.textContent = currentCollaborativeName; 
            questionTitlePrefixElement.textContent = `Pregunta de ${currentCollaborativeName}:`;
            if (questionElement) {
                questionElement.textContent = `Esperando la pregunta de ${currentCollaborativeName}...`;
            }
        };

        // Llama a la función al cargar el script por primera vez
        updateQuestionTitles();


        // Función para Iniciar/Cerrar Sesión de Administrador
        authButton.addEventListener('click', () => {
            if (document.body.classList.contains('admin-mode')) {
                // Si está en modo admin, significa que es para cerrar sesión
                document.body.classList.remove('admin-mode');
                authButton.textContent = 'Iniciar Sesión (Admin)';
                alert('Sesión de administrador cerrada.');
                socket.emit('request chat history'); 
            } else {
                // Si no está en modo admin, es para iniciar sesión
                const password = prompt("Introduce la contraseña de administrador:");
                if (password) {
                    socket.emit('admin:authenticate', password); // Enviar la contraseña al backend
                }
            }
        });

        // --- Funciones de Utilidad ---

        const generateAnonymousName = () => {
            currentAnonymousName = localStorage.getItem('kayla_anonymous_name');
            if (!currentAnonymousName) {
                const randomIndex = Math.floor(Math.random() * anonymousNames.length);
                currentAnonymousName = anonymousNames[randomIndex];
                localStorage.setItem('kayla_anonymous_name', currentAnonymousName);
            }
            anonymousNameElement.textContent = `Tu identidad anónima: ${currentAnonymousName}`;
            // Esto se manejará al mostrar el chatMainContent
            // anonymousNameElement.parentElement.style.opacity = '1';
            // anonymousNameElement.parentElement.style.transform = 'translateY(0)';
        };

        // Función para mostrar un mensaje en el chat
        const displayMessage = (messageData) => {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.setAttribute('data-timestamp', messageData.timestamp); 

            messageDiv.innerHTML = `<strong>${messageData.username}:</strong> ${messageData.content}`;

            // Solo si el usuario actual es admin, muestra el botón de eliminar
            if (document.body.classList.contains('admin-mode')) {
                const deleteBtn = document.createElement('button');
                deleteBtn.classList.add('delete-btn');
                deleteBtn.textContent = 'X';
                deleteBtn.onclick = () => {
                    if (confirm('¿Estás seguro de que quieres eliminar este comentario?')) {
                        socket.emit('admin:delete message', messageData.timestamp);
                    }
                };
                messageDiv.appendChild(deleteBtn);
            }

            chatMessagesElement.appendChild(messageDiv);
            chatMessagesElement.scrollTop = chatMessagesElement.scrollHeight;
        };

        // --- Lógica del Administrador ---

        // Manejo de la actualización de la pregunta
        updateQuestionBtn.addEventListener('click', () => {
            const newQuestionText = adminQuestionInput.value.trim();
            if (newQuestionText) {
                socket.emit('admin:set question', newQuestionText);
            } else {
                alert("Por favor, escribe una pregunta.");
            }
        });

        // --- Lógica del Chat ---

        // Envío de mensajes
        const sendMessage = () => {
            const messageText = messageInput.value.trim();
            if (messageText && currentAnonymousName) {
                socket.emit('chat message', {
                    username: currentAnonymousName,
                    content: messageText
                });
                messageInput.value = ''; // Limpia el input después de enviar
            } else if (!messageText) {
                alert("Por favor, escribe un mensaje antes de enviar.");
            } else if (!currentAnonymousName) {
                alert("Tu nombre anónimo no se ha generado. Recarga la página.");
            }
        };

        // --- Event Listeners de Socket.IO (lo que recibe del backend) ---

        // Este evento se dispara cuando te conectas y recibes el historial de mensajes
        socket.on('chat history', (history) => {
            chatMessagesElement.innerHTML = ''; // Limpia el chat al recibir el historial completo
            history.forEach(msg => displayMessage(msg)); // Vuelve a dibujar todos los mensajes
        });

        // Este evento se dispara cuando llega un nuevo mensaje
        socket.on('chat message', (msg) => {
            displayMessage(msg);
        });

        // Este evento se dispara cuando la pregunta es actualizada (por el admin o al cargar)
        socket.on('question update', (question) => {
            questionElement.textContent = question;
            // Si eres un admin, también actualiza el input de la pregunta en el panel de admin
            if (document.body.classList.contains('admin-mode')) {
                adminQuestionInput.value = question;
            }
        });

        // Este evento se dispara cuando el admin se autentica correctamente
        socket.on('admin:authenticated', () => {
            document.body.classList.add('admin-mode'); // Activa el modo admin visualmente
            authButton.textContent = 'Cerrar Sesión (Admin)';
            alert('Autenticación de administrador exitosa.');
            socket.emit('request chat history'); 
            socket.emit('request question update'); 
        });

        // Este evento se dispara cuando un mensaje es eliminado por el admin
        socket.on('message deleted', (timestampToDelete) => {
            const messageToDelete = chatMessagesElement.querySelector(`[data-timestamp="${timestampToDelete}"]`);
            if (messageToDelete) {
                messageToDelete.remove();
            }
        });

        // Este evento se dispara cuando el chat es borrado por el admin
        socket.on('chat cleared', () => {
            chatMessagesElement.innerHTML = ''; // Vacía el contenedor de mensajes
            const initialMessageDiv = document.createElement('div');
            initialMessageDiv.classList.add('message');
            initialMessageDiv.textContent = '¡Hola! Este es un espacio anónimo. ¡Sé respetuoso/a y diviértete!';
            chatMessagesElement.appendChild(initialMessageDiv);
        });


        // --- Inicialización al cargar la página ---
        document.addEventListener('DOMContentLoaded', () => {
            // CAMBIO: La generación del nombre anónimo y la solicitud de historial se mueven al hacer clic en 'Continuar'
            // generateAnonymousName(); 
            // socket.emit('request chat history'); 
            // socket.emit('request question update'); // Solicita la pregunta actual al iniciar

            sendButton.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    sendMessage();
                }
            });

            // NUEVO: Manejador del botón "Continuar al Chat"
            startChatButton.addEventListener('click', () => {
                welcomeScreen.style.display = 'none'; // Oculta la pantalla de bienvenida
                chatMainContent.style.display = 'flex'; // Muestra el contenido principal del chat
                
                // Ahora sí, genera el nombre anónimo y solicita los datos del chat
                generateAnonymousName(); 
                socket.emit('request chat history'); 
                socket.emit('request question update'); 

                // Muestra las secciones que estaban ocultas por defecto en el chat-main-content
                document.querySelector('.anonymous-name-section').style.display = 'block';
                document.querySelector('.question-section').style.display = 'block';
                document.querySelector('.chat-section').style.display = 'flex'; // Chat section es flex para input area
            });
        });
    </script>
</body>
</html>
